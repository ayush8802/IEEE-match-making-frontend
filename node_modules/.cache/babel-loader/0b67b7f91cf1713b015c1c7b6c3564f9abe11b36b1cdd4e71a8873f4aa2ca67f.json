{"ast":null,"code":"var _jsxFileName = \"D:\\\\ieee match making\\\\frontend\\\\src\\\\pages\\\\Chat.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport { supabase } from \"../config/supabase\";\nimport ChatSidebar from \"../components/Chat/ChatSidebar\";\nimport ChatWindow from \"../components/Chat/ChatWindow\";\nimport { useLocation } from \"react-router-dom\";\nimport \"../styles/chat.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat() {\n  _s();\n  const [users, setUsers] = useState([]);\n  const [activeUser, setActiveUser] = useState(null);\n  const [messages, setMessages] = useState([]); // List of messages for active user\n  const [loading, setLoading] = useState(true);\n  const location = useLocation();\n\n  // 1. Fetch Users (Mutual Recommendations)\n  useEffect(() => {\n    const fetchUsers = async () => {\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) return;\n      const {\n        data,\n        error\n      } = await supabase.from(\"questionnaire_responses\").select(\"mutual_recommendation\").eq(\"user_id\", user.id).single();\n      if (error) {\n        console.error(\"Error fetching chat users:\", error);\n      } else if (data && data.mutual_recommendation) {\n        try {\n          var _location$state;\n          const parsed = typeof data.mutual_recommendation === \"string\" ? JSON.parse(data.mutual_recommendation) : data.mutual_recommendation;\n          const userList = Array.isArray(parsed) ? parsed : [];\n          setUsers(userList);\n\n          // Check if navigated with a pre-selected user\n          if ((_location$state = location.state) !== null && _location$state !== void 0 && _location$state.selectedUser) {\n            const preSelected = userList.find(u => u.name === location.state.selectedUser.name);\n            if (preSelected) setActiveUser(preSelected);\n          }\n        } catch (err) {\n          console.error(\"JSON Parse error:\", err);\n        }\n      }\n      setLoading(false);\n    };\n    fetchUsers();\n  }, [location.state]);\n\n  // 2. Fetch Messages when Active User changes\n  useEffect(() => {\n    const fetchMessages = async () => {\n      if (!activeUser || !activeUser.Email) {\n        setMessages([]);\n        return;\n      }\n      const {\n        data: {\n          user\n        }\n      } = await supabase.auth.getUser();\n      if (!user) return;\n      const {\n        data,\n        error\n      } = await supabase.from(\"messages\").select(\"*\").eq(\"sender_id\", user.id).eq(\"receiver_email\", activeUser.Email).order(\"created_at\", {\n        ascending: true\n      });\n      if (error) {\n        console.error(\"Error fetching messages:\", error);\n      } else {\n        const dbMessages = (data || []).map(msg => ({\n          id: msg.id,\n          text: msg.content,\n          sender: 'me',\n          timestamp: msg.created_at\n        }));\n        setMessages(dbMessages);\n      }\n    };\n    fetchMessages();\n  }, [activeUser]);\n  const handleSelectUser = user => {\n    setActiveUser(user);\n  };\n  const handleSendMessage = async text => {\n    if (!activeUser || !activeUser.Email) {\n      alert(\"This user has no email, cannot send message.\");\n      return;\n    }\n    const {\n      data: {\n        user\n      }\n    } = await supabase.auth.getUser();\n    if (!user) return;\n\n    // Optimistic UI update\n    const tempId = Date.now();\n    const newMessage = {\n      id: tempId,\n      text,\n      sender: 'me',\n      timestamp: new Date().toISOString()\n    };\n    setMessages(prev => [...prev, newMessage]);\n\n    // Save to Supabase\n    const {\n      error\n    } = await supabase.from(\"messages\").insert({\n      sender_id: user.id,\n      receiver_email: activeUser.Email,\n      content: text\n    });\n    if (error) {\n      console.error(\"Error sending message:\", error);\n      alert(\"Failed to save message to database\");\n    }\n\n    // Simulate reply (Local only)\n    setTimeout(() => {\n      const reply = {\n        id: Date.now() + 1,\n        text: \"Thanks for reaching out! (Auto-reply: This message is not saved to DB)\",\n        sender: 'them',\n        timestamp: new Date().toISOString()\n      };\n      setMessages(prev => [...prev, reply]);\n    }, 1000);\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"loading-spinner\",\n    children: \"Loading chat...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 25\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-container\",\n    children: [/*#__PURE__*/_jsxDEV(ChatSidebar, {\n      users: users,\n      activeUser: activeUser,\n      onSelectUser: handleSelectUser\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(ChatWindow, {\n      activeUser: activeUser,\n      messages: messages,\n      onSendMessage: handleSendMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 139,\n    columnNumber: 9\n  }, this);\n}\n_s(Chat, \"zO/nLrfs1/t/R9OW2lEMzE9VU34=\", false, function () {\n  return [useLocation];\n});\n_c = Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","supabase","ChatSidebar","ChatWindow","useLocation","jsxDEV","_jsxDEV","Chat","_s","users","setUsers","activeUser","setActiveUser","messages","setMessages","loading","setLoading","location","fetchUsers","data","user","auth","getUser","error","from","select","eq","id","single","console","mutual_recommendation","_location$state","parsed","JSON","parse","userList","Array","isArray","state","selectedUser","preSelected","find","u","name","err","fetchMessages","Email","order","ascending","dbMessages","map","msg","text","content","sender","timestamp","created_at","handleSelectUser","handleSendMessage","alert","tempId","Date","now","newMessage","toISOString","prev","insert","sender_id","receiver_email","setTimeout","reply","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onSelectUser","onSendMessage","_c","$RefreshReg$"],"sources":["D:/ieee match making/frontend/src/pages/Chat.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { supabase } from \"../config/supabase\";\r\nimport ChatSidebar from \"../components/Chat/ChatSidebar\";\r\nimport ChatWindow from \"../components/Chat/ChatWindow\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport \"../styles/chat.css\";\r\n\r\nexport default function Chat() {\r\n    const [users, setUsers] = useState([]);\r\n    const [activeUser, setActiveUser] = useState(null);\r\n    const [messages, setMessages] = useState([]); // List of messages for active user\r\n    const [loading, setLoading] = useState(true);\r\n    const location = useLocation();\r\n\r\n    // 1. Fetch Users (Mutual Recommendations)\r\n    useEffect(() => {\r\n        const fetchUsers = async () => {\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            const { data, error } = await supabase\r\n                .from(\"questionnaire_responses\")\r\n                .select(\"mutual_recommendation\")\r\n                .eq(\"user_id\", user.id)\r\n                .single();\r\n\r\n            if (error) {\r\n                console.error(\"Error fetching chat users:\", error);\r\n            } else if (data && data.mutual_recommendation) {\r\n                try {\r\n                    const parsed = typeof data.mutual_recommendation === \"string\"\r\n                        ? JSON.parse(data.mutual_recommendation)\r\n                        : data.mutual_recommendation;\r\n\r\n                    const userList = Array.isArray(parsed) ? parsed : [];\r\n                    setUsers(userList);\r\n\r\n                    // Check if navigated with a pre-selected user\r\n                    if (location.state?.selectedUser) {\r\n                        const preSelected = userList.find(u => u.name === location.state.selectedUser.name);\r\n                        if (preSelected) setActiveUser(preSelected);\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"JSON Parse error:\", err);\r\n                }\r\n            }\r\n            setLoading(false);\r\n        };\r\n\r\n        fetchUsers();\r\n    }, [location.state]);\r\n\r\n    // 2. Fetch Messages when Active User changes\r\n    useEffect(() => {\r\n        const fetchMessages = async () => {\r\n            if (!activeUser || !activeUser.Email) {\r\n                setMessages([]);\r\n                return;\r\n            }\r\n\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n            if (!user) return;\r\n\r\n            const { data, error } = await supabase\r\n                .from(\"messages\")\r\n                .select(\"*\")\r\n                .eq(\"sender_id\", user.id)\r\n                .eq(\"receiver_email\", activeUser.Email)\r\n                .order(\"created_at\", { ascending: true });\r\n\r\n            if (error) {\r\n                console.error(\"Error fetching messages:\", error);\r\n            } else {\r\n                const dbMessages = (data || []).map(msg => ({\r\n                    id: msg.id,\r\n                    text: msg.content,\r\n                    sender: 'me',\r\n                    timestamp: msg.created_at\r\n                }));\r\n                setMessages(dbMessages);\r\n            }\r\n        };\r\n\r\n        fetchMessages();\r\n    }, [activeUser]);\r\n\r\n    const handleSelectUser = (user) => {\r\n        setActiveUser(user);\r\n    };\r\n\r\n    const handleSendMessage = async (text) => {\r\n        if (!activeUser || !activeUser.Email) {\r\n            alert(\"This user has no email, cannot send message.\");\r\n            return;\r\n        }\r\n\r\n        const { data: { user } } = await supabase.auth.getUser();\r\n        if (!user) return;\r\n\r\n        // Optimistic UI update\r\n        const tempId = Date.now();\r\n        const newMessage = {\r\n            id: tempId,\r\n            text,\r\n            sender: 'me',\r\n            timestamp: new Date().toISOString()\r\n        };\r\n        setMessages(prev => [...prev, newMessage]);\r\n\r\n        // Save to Supabase\r\n        const { error } = await supabase\r\n            .from(\"messages\")\r\n            .insert({\r\n                sender_id: user.id,\r\n                receiver_email: activeUser.Email,\r\n                content: text\r\n            });\r\n\r\n        if (error) {\r\n            console.error(\"Error sending message:\", error);\r\n            alert(\"Failed to save message to database\");\r\n        }\r\n\r\n        // Simulate reply (Local only)\r\n        setTimeout(() => {\r\n            const reply = {\r\n                id: Date.now() + 1,\r\n                text: \"Thanks for reaching out! (Auto-reply: This message is not saved to DB)\",\r\n                sender: 'them',\r\n                timestamp: new Date().toISOString()\r\n            };\r\n            setMessages(prev => [...prev, reply]);\r\n        }, 1000);\r\n    };\r\n\r\n    if (loading) return <div className=\"loading-spinner\">Loading chat...</div>;\r\n\r\n    return (\r\n        <div className=\"chat-container\">\r\n            <ChatSidebar\r\n                users={users}\r\n                activeUser={activeUser}\r\n                onSelectUser={handleSelectUser}\r\n            />\r\n            <ChatWindow\r\n                activeUser={activeUser}\r\n                messages={messages}\r\n                onSendMessage={handleSendMessage}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AAClD,SAASC,QAAQ,QAAQ,oBAAoB;AAC7C,OAAOC,WAAW,MAAM,gCAAgC;AACxD,OAAOC,UAAU,MAAM,+BAA+B;AACtD,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAO,oBAAoB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5B,eAAe,SAASC,IAAIA,CAAA,EAAG;EAAAC,EAAA;EAC3B,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGX,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACY,UAAU,EAAEC,aAAa,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EAClD,MAAM,CAACc,QAAQ,EAAEC,WAAW,CAAC,GAAGf,QAAQ,CAAC,EAAE,CAAC,CAAC,CAAC;EAC9C,MAAM,CAACgB,OAAO,EAAEC,UAAU,CAAC,GAAGjB,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAMkB,QAAQ,GAAGb,WAAW,CAAC,CAAC;;EAE9B;EACAJ,SAAS,CAAC,MAAM;IACZ,MAAMkB,UAAU,GAAG,MAAAA,CAAA,KAAY;MAC3B,MAAM;QAAEC,IAAI,EAAE;UAAEC;QAAK;MAAE,CAAC,GAAG,MAAMnB,QAAQ,CAACoB,IAAI,CAACC,OAAO,CAAC,CAAC;MACxD,IAAI,CAACF,IAAI,EAAE;MAEX,MAAM;QAAED,IAAI;QAAEI;MAAM,CAAC,GAAG,MAAMtB,QAAQ,CACjCuB,IAAI,CAAC,yBAAyB,CAAC,CAC/BC,MAAM,CAAC,uBAAuB,CAAC,CAC/BC,EAAE,CAAC,SAAS,EAAEN,IAAI,CAACO,EAAE,CAAC,CACtBC,MAAM,CAAC,CAAC;MAEb,IAAIL,KAAK,EAAE;QACPM,OAAO,CAACN,KAAK,CAAC,4BAA4B,EAAEA,KAAK,CAAC;MACtD,CAAC,MAAM,IAAIJ,IAAI,IAAIA,IAAI,CAACW,qBAAqB,EAAE;QAC3C,IAAI;UAAA,IAAAC,eAAA;UACA,MAAMC,MAAM,GAAG,OAAOb,IAAI,CAACW,qBAAqB,KAAK,QAAQ,GACvDG,IAAI,CAACC,KAAK,CAACf,IAAI,CAACW,qBAAqB,CAAC,GACtCX,IAAI,CAACW,qBAAqB;UAEhC,MAAMK,QAAQ,GAAGC,KAAK,CAACC,OAAO,CAACL,MAAM,CAAC,GAAGA,MAAM,GAAG,EAAE;UACpDtB,QAAQ,CAACyB,QAAQ,CAAC;;UAElB;UACA,KAAAJ,eAAA,GAAId,QAAQ,CAACqB,KAAK,cAAAP,eAAA,eAAdA,eAAA,CAAgBQ,YAAY,EAAE;YAC9B,MAAMC,WAAW,GAAGL,QAAQ,CAACM,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,KAAK1B,QAAQ,CAACqB,KAAK,CAACC,YAAY,CAACI,IAAI,CAAC;YACnF,IAAIH,WAAW,EAAE5B,aAAa,CAAC4B,WAAW,CAAC;UAC/C;QACJ,CAAC,CAAC,OAAOI,GAAG,EAAE;UACVf,OAAO,CAACN,KAAK,CAAC,mBAAmB,EAAEqB,GAAG,CAAC;QAC3C;MACJ;MACA5B,UAAU,CAAC,KAAK,CAAC;IACrB,CAAC;IAEDE,UAAU,CAAC,CAAC;EAChB,CAAC,EAAE,CAACD,QAAQ,CAACqB,KAAK,CAAC,CAAC;;EAEpB;EACAtC,SAAS,CAAC,MAAM;IACZ,MAAM6C,aAAa,GAAG,MAAAA,CAAA,KAAY;MAC9B,IAAI,CAAClC,UAAU,IAAI,CAACA,UAAU,CAACmC,KAAK,EAAE;QAClChC,WAAW,CAAC,EAAE,CAAC;QACf;MACJ;MAEA,MAAM;QAAEK,IAAI,EAAE;UAAEC;QAAK;MAAE,CAAC,GAAG,MAAMnB,QAAQ,CAACoB,IAAI,CAACC,OAAO,CAAC,CAAC;MACxD,IAAI,CAACF,IAAI,EAAE;MAEX,MAAM;QAAED,IAAI;QAAEI;MAAM,CAAC,GAAG,MAAMtB,QAAQ,CACjCuB,IAAI,CAAC,UAAU,CAAC,CAChBC,MAAM,CAAC,GAAG,CAAC,CACXC,EAAE,CAAC,WAAW,EAAEN,IAAI,CAACO,EAAE,CAAC,CACxBD,EAAE,CAAC,gBAAgB,EAAEf,UAAU,CAACmC,KAAK,CAAC,CACtCC,KAAK,CAAC,YAAY,EAAE;QAAEC,SAAS,EAAE;MAAK,CAAC,CAAC;MAE7C,IAAIzB,KAAK,EAAE;QACPM,OAAO,CAACN,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MACpD,CAAC,MAAM;QACH,MAAM0B,UAAU,GAAG,CAAC9B,IAAI,IAAI,EAAE,EAAE+B,GAAG,CAACC,GAAG,KAAK;UACxCxB,EAAE,EAAEwB,GAAG,CAACxB,EAAE;UACVyB,IAAI,EAAED,GAAG,CAACE,OAAO;UACjBC,MAAM,EAAE,IAAI;UACZC,SAAS,EAAEJ,GAAG,CAACK;QACnB,CAAC,CAAC,CAAC;QACH1C,WAAW,CAACmC,UAAU,CAAC;MAC3B;IACJ,CAAC;IAEDJ,aAAa,CAAC,CAAC;EACnB,CAAC,EAAE,CAAClC,UAAU,CAAC,CAAC;EAEhB,MAAM8C,gBAAgB,GAAIrC,IAAI,IAAK;IAC/BR,aAAa,CAACQ,IAAI,CAAC;EACvB,CAAC;EAED,MAAMsC,iBAAiB,GAAG,MAAON,IAAI,IAAK;IACtC,IAAI,CAACzC,UAAU,IAAI,CAACA,UAAU,CAACmC,KAAK,EAAE;MAClCa,KAAK,CAAC,8CAA8C,CAAC;MACrD;IACJ;IAEA,MAAM;MAAExC,IAAI,EAAE;QAAEC;MAAK;IAAE,CAAC,GAAG,MAAMnB,QAAQ,CAACoB,IAAI,CAACC,OAAO,CAAC,CAAC;IACxD,IAAI,CAACF,IAAI,EAAE;;IAEX;IACA,MAAMwC,MAAM,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACzB,MAAMC,UAAU,GAAG;MACfpC,EAAE,EAAEiC,MAAM;MACVR,IAAI;MACJE,MAAM,EAAE,IAAI;MACZC,SAAS,EAAE,IAAIM,IAAI,CAAC,CAAC,CAACG,WAAW,CAAC;IACtC,CAAC;IACDlD,WAAW,CAACmD,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEF,UAAU,CAAC,CAAC;;IAE1C;IACA,MAAM;MAAExC;IAAM,CAAC,GAAG,MAAMtB,QAAQ,CAC3BuB,IAAI,CAAC,UAAU,CAAC,CAChB0C,MAAM,CAAC;MACJC,SAAS,EAAE/C,IAAI,CAACO,EAAE;MAClByC,cAAc,EAAEzD,UAAU,CAACmC,KAAK;MAChCO,OAAO,EAAED;IACb,CAAC,CAAC;IAEN,IAAI7B,KAAK,EAAE;MACPM,OAAO,CAACN,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;MAC9CoC,KAAK,CAAC,oCAAoC,CAAC;IAC/C;;IAEA;IACAU,UAAU,CAAC,MAAM;MACb,MAAMC,KAAK,GAAG;QACV3C,EAAE,EAAEkC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,CAAC;QAClBV,IAAI,EAAE,wEAAwE;QAC9EE,MAAM,EAAE,MAAM;QACdC,SAAS,EAAE,IAAIM,IAAI,CAAC,CAAC,CAACG,WAAW,CAAC;MACtC,CAAC;MACDlD,WAAW,CAACmD,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAEK,KAAK,CAAC,CAAC;IACzC,CAAC,EAAE,IAAI,CAAC;EACZ,CAAC;EAED,IAAIvD,OAAO,EAAE,oBAAOT,OAAA;IAAKiE,SAAS,EAAC,iBAAiB;IAAAC,QAAA,EAAC;EAAe;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAAC;EAE1E,oBACItE,OAAA;IAAKiE,SAAS,EAAC,gBAAgB;IAAAC,QAAA,gBAC3BlE,OAAA,CAACJ,WAAW;MACRO,KAAK,EAAEA,KAAM;MACbE,UAAU,EAAEA,UAAW;MACvBkE,YAAY,EAAEpB;IAAiB;MAAAgB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAClC,CAAC,eACFtE,OAAA,CAACH,UAAU;MACPQ,UAAU,EAAEA,UAAW;MACvBE,QAAQ,EAAEA,QAAS;MACnBiE,aAAa,EAAEpB;IAAkB;MAAAe,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpC,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACD,CAAC;AAEd;AAACpE,EAAA,CAhJuBD,IAAI;EAAA,QAKPH,WAAW;AAAA;AAAA2E,EAAA,GALRxE,IAAI;AAAA,IAAAwE,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}